!function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=32)}([function(e,t,n){"use strict";var s=n(10);t.__esModule=!0,t.default=void 0;var i=s(n(30)).default;t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SAMPLE="sample",e.NOTE="note"}(t.SequenceEventType||(t.SequenceEventType={})),function(e){e.IDLE="idle",e.LOADING="loading",e.PLAYING="playing"}(t.SequencePlayerState||(t.SequencePlayerState={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.stopped=!1,this.update=(()=>{this.stopped||(this.callback(),requestAnimationFrame(this.update))}),this.callback=e}start(){this.stopped=!1,this.update()}stop(){this.stopped=!0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=0,i=function(){function e(e,t,n,s){void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===s&&(s=!1),this.type=e,this.bubbles=t,this.cancelable=n,this.currentTarget=null,this.target=null,this.eventPhase=0,this.defaultPrevented=!1,this.timeStamp=s?Date.now():0}return e.prototype.stopPropagation=function(){s<1&&(s=1)},e.prototype.stopImmediatePropagation=function(){s=2},e.prototype.preventDefault=function(){if(!this.cancelable)throw new Error("Called preventDefault on a non-cancelable event");this.defaultPrevented=!0},e.prototype.callListener=function(e){return s=0,e.call(null,this),s},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(6),i=function(e){function t(t,n,s,i,r){var a=e.call(this)||this;return a.dispatcher=t,a.type=n,a.handler=s,a.useCapture=i,a.priority=r,a.isRemoved=!1,a}return s.__extends(t,e),t.prototype.dispose=function(){this.dispatcher&&(this.dispatcher.removeEventListener(this.type,this.handler,this.useCapture),this.dispatcher=null),e.prototype.dispose.call(this)},t}(n(5).default);t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(19);t.default=s.default},function(e,t,n){"use strict";n.r(t),n.d(t,"__extends",function(){return i}),n.d(t,"__assign",function(){return r}),n.d(t,"__rest",function(){return a}),n.d(t,"__decorate",function(){return o}),n.d(t,"__param",function(){return u}),n.d(t,"__metadata",function(){return l}),n.d(t,"__awaiter",function(){return c}),n.d(t,"__generator",function(){return h}),n.d(t,"__exportStar",function(){return d}),n.d(t,"__values",function(){return f}),n.d(t,"__read",function(){return p}),n.d(t,"__spread",function(){return m}),n.d(t,"__await",function(){return y}),n.d(t,"__asyncGenerator",function(){return v}),n.d(t,"__asyncDelegator",function(){return b}),n.d(t,"__asyncValues",function(){return S}),n.d(t,"__makeTemplateObject",function(){return g}),n.d(t,"__importStar",function(){return P}),n.d(t,"__importDefault",function(){return x});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function i(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var r=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};function a(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&(n[s[i]]=e[s[i]])}return n}function o(e,t,n,s){var i,r=arguments.length,a=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a}function u(e,t){return function(n,s){t(n,s,e)}}function l(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function c(e,t,n,s){return new(n||(n=Promise))(function(i,r){function a(e){try{u(s.next(e))}catch(e){r(e)}}function o(e){try{u(s.throw(e))}catch(e){r(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,o)}u((s=s.apply(e,t||[])).next())})}function h(e,t){var n,s,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,s&&(i=s[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(s,r[1])).done)return i;switch(s=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,s=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],s=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}}function d(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function f(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function p(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var s,i,r=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(s=r.next()).done;)a.push(s.value)}catch(e){i={error:e}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return a}function m(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}function y(e){return this instanceof y?(this.v=e,this):new y(e)}function v(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,i=n.apply(e,t||[]),r=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(e){i[e]&&(s[e]=function(t){return new Promise(function(n,s){r.push([e,t,n,s])>1||o(e,t)})})}function o(e,t){try{(n=i[e](t)).value instanceof y?Promise.resolve(n.value.v).then(u,l):c(r[0][2],n)}catch(e){c(r[0][3],e)}var n}function u(e){o("next",e)}function l(e){o("throw",e)}function c(e,t){e(t),r.shift(),r.length&&o(r[0][0],r[0][1])}}function b(e){var t,n;return t={},s("next"),s("throw",function(e){throw e}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(s,i){e[s]&&(t[s]=function(t){return(n=!n)?{value:y(e[s](t)),done:"return"===s}:i?i(t):t})}}function S(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator];return t?t.call(e):f(e)}function g(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function P(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function x(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";t.__esModule=!0,t.createSamplesFromNames=function(e){return e.map(function(e){return{name:e}})},t.loadSamples=function(e,t,n,i,r){var a;if(r){var o=t.map(function(e){return e.audioBuffer?1:0});a=function(e,t){o[e]=t,r(o.reduce(function(e,t){return e+t},0)/o.length)}}var u=t.map(function(t,r){if(t.audioBuffer)return Promise.resolve();var o=""+i+(t.path||"")+t.fileName+"."+(t.extension||n);return(0,s.loadAudioBuffer)(e,o,a?function(e){a(r,e)}:null).then(function(e){t.audioBuffer=e.audioBuffer,t.fileSize=e.fileSize})});return Promise.all(u).then(function(){})};var s=n(24)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(0);t.createSampleSequence=function(e,t){const n={id:e,target:null,events:[]};if(0===Object.keys(t).length)throw new Error("Can't create a sequence without events");var r,a;return Object.keys(t).forEach(e=>{const o=t[e];for(let t=0;t<o.length;t+=2){const u=o[t],l=o[t+1]||1;if(void 0!==l&&"number"!=typeof l)throw new TypeError(`Expecting a volume value but found a ${typeof l}`);const c=Object.assign({sampleName:u,volume:l,sample:null},(r=s.SequenceEventType.SAMPLE,a=i.default.fromString(e),{type:r,relativeStart:a,lastScheduledData:{}}));n.events.push(c)}}),function(e){e.events.sort((e,t)=>e.relativeStart.toSixteenths()-t.relativeStart.toSixteenths())}(n),n},t.getLatestEventInSequence=function(e){let t,n=0;return e.events.forEach(e=>{const s=e.relativeStart.toSixteenths();s>n&&(t=e,n=s)}),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(0);t.setSamplesOnSampleEvents=function(e,t){for(let n=0;n<e.sequences.length;n++)for(let i=0;i<e.sequences[n].events.length;i++){const r=e.sequences[n].events[i];r.type===s.SequenceEventType.SAMPLE&&(r.sample=t.getSampleByName(r.sampleName))}},t.getSongEndTime=function(e){let t=new i.default(0,0,0);return e.timedSequences.forEach(e=>{e.sequence.events.forEach(n=>{const s=e.absoluteStart.add(n.relativeStart);s.toSixteenths()>t.toSixteenths()&&(t=s)})}),new i.default(t.bars+1,0,0)}},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);function i(e,t,n){const s=document.createElement("div");return s.style.width=`${t.width}px`,s.style.height=`${t.height}px`,s.style.left=`${e.x}px`,s.style.top=`${e.y}px`,s.style.position="absolute",s.style.backgroundColor=n,s}function r(e,t,n){return e.toTime(t)*n}t.createSequenceElement=function(e,t,n,s,a,o,u,l,c=3){const h=i(t,n,s),d=document.createElement("p");d.innerText=e.id,d.style.margin="0px",d.style.padding="1px 4px",d.style.height=`${a}px`,d.style.backgroundColor="rgba(0,0,0,0.4)",d.style.color="white",d.style.boxSizing="border-box",d.style.fontSize="11px",h.appendChild(d);const f=n.height-a,p=document.createElement("div");p.style.height=`${f}px`,p.style.position="relative",h.appendChild(p);const m=f/c;return e.events.forEach((e,t)=>{const n=i({x:r(e.relativeStart,u,o),y:t%c*m},{width:l-1,height:m-1},"rgba(255,255,255,1)");n.innerText=e.sampleName[0],n.title=e.sampleName,p.appendChild(n)}),h},t.createSection=function(e,t,n){return i(t,n,"#00cc00")},t.createRectElement=i,t.createTimelineCanvas=function(e,t,n){const s=document.createElement("canvas"),i=s.getContext("2d");return s.width=parseInt(e.style.width,10),s.height=t,s.style.position="absolute",s.style.top=`${n}px`,e.appendChild(s),i},t.drawTimeline=function(e,t,n,i){e.fillStyle="black",e.strokeStyle="white",e.fillRect(0,0,e.canvas.width,e.canvas.height);const r=new s.default(0,1,0).toTime(i)*n;let a=t,o=0;for(;a<e.canvas.width;){e.beginPath();const t=Math.round(a)+.5;e.moveTo(t,e.canvas.height);let n=.5,i=.25;o%4==0&&(n=2,i=.4);const u=e.canvas.height-e.canvas.height*i;e.lineTo(t,u),e.lineWidth=n,e.stroke(),2===n&&(e.fillStyle="white",e.textAlign="center",e.fillText(new s.default(0,o,0).toString(),t,u-3)),a+=r,o+=1}},t.musicTimeToPixels=r,t.createVerticalLine=function(e,t,n){const s=document.createElement("div");return s.style.width="1px",s.style.height=`${e}px`,s.style.left=`${t.x}px`,s.style.top=`${t.y}px`,s.style.position="absolute",s.style.zIndex="999",s.style.backgroundColor=n,s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(8),i=n(0),r=n(11),a=n(2),o=n(1);t.default=class{constructor(e,t){this.pixelsPerSecond=40,this.defaultEventDuration=i.default.fromString("0.0.1"),this.sequenceHeight=70,this.colors=["#b3d9ff","#66b3ff"],this.seqsOffset={x:30,y:110},this.seqLabelheight=15,this.seqSpacing={x:1,y:1},this.timelineHeight=30,this.timelineSpacing=20,this.updateFrame=new a.default(this.onUpdate.bind(this)),this.element=e,e.style.position="relative",e.style.backgroundColor="#444",this.player=t,t.addEventListener("state-change",e=>{switch(e.data){case o.SequencePlayerState.IDLE:this.updateFrame.stop(),this.updatePlayheadPosition();break;case o.SequencePlayerState.PLAYING:this.updateFrame.start()}});const n=this.seqsOffset.x+this.player.timeData.playTime*this.pixelsPerSecond,s=this.seqsOffset.y;this.playHead=r.createVerticalLine(0,{x:n,y:s},"red"),this.element.appendChild(this.playHead),this.songEnd=r.createVerticalLine(0,{x:n,y:s},"lime"),this.element.appendChild(this.songEnd),this.timeLineContext=r.createTimelineCanvas(e,this.timelineHeight,this.seqsOffset.y-this.timelineHeight-this.timelineSpacing)}onUpdate(){this.updatePlayheadPosition()}setSong(e){this.song=e,this.drawSong(),this.setLineHeights(),r.drawTimeline(this.timeLineContext,this.seqsOffset.x,this.pixelsPerSecond,this.song.bpm),this.songEnd.style.left=`${this.seqsOffset.x+r.musicTimeToPixels(e.getSongEndTime(),e.bpm,this.pixelsPerSecond)}px`}drawSong(){this.song.timedSequences.forEach(e=>{const t=this.song.sequences.indexOf(e.sequence),n=this.seqsOffset.x+this.musicTimeToPixels(e.absoluteStart),s=this.seqsOffset.y+t*(this.sequenceHeight+this.seqSpacing.y),i=this.getSequenceWidth(e.sequence)-this.seqSpacing.x,a=this.sequenceHeight,o=r.createSequenceElement(e.sequence,{x:n,y:s},{width:i,height:a},this.colors[t%2],this.seqLabelheight,this.pixelsPerSecond,this.song.bpm,this.musicTimeToPixels(this.defaultEventDuration));this.element.appendChild(o)}),this.song.getSections().forEach(e=>{this.element.appendChild(r.createSection(e,{x:this.seqsOffset.x+this.musicTimeToPixels(e.start),y:this.seqsOffset.y-20},{width:this.musicTimeToPixels(e.end.subtract(e.start)),height:10}))})}updatePlayheadPosition(){const e=this.seqsOffset.x+this.player.timeData.playTime*this.pixelsPerSecond;this.playHead.style.left=`${e}px`}setLineHeights(){const e=this.song.sequences.length*(this.sequenceHeight+this.seqSpacing.y)-this.seqSpacing.y;this.playHead.style.height=`${e}px`,this.songEnd.style.height=`${e}px`}getSequenceWidth(e){const t=s.getLatestEventInSequence(e),n=new i.default(t.relativeStart.bars+1,0,0);return this.musicTimeToPixels(n)}musicTimeToPixels(e){return r.musicTimeToPixels(e,this.song.bpm,this.pixelsPerSecond)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.initTimeData=function(){return{playTime:0,playMusicTime:new s.default(0,0,0)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3);class i extends s.default{constructor(e,t,n=!1,s=!1,i=!1){super(e,n,s,i),this.data=t}clone(){return new i(this.type,this.data,this.bubbles,this.cancelable,0!==this.timeStamp)}}t.SequencePlayerEvent=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.playBuffer=function(e,t,n,s,i,r=-1,a=1){if(s<e.currentTime)return null;const o=e.createGain(),u=e.createBufferSource();return o.gain.value=a,u.buffer=n,u.connect(o),o.connect(t),u.start(s,i,-1===r?void 0:r),{bufferSourceNode:u,gainNode:o}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(15);t.default=class{constructor(e,t){this.playingSamples=[],this.context=e,this.output=t}playSample(e,t){const n=e.event,i=s.playBuffer(this.context,this.output,n.sample.audioBuffer,e.absoluteSeconds+t,0,-1,n.volume);this.playingSamples.push(i),i.bufferSourceNode.onended=(()=>{const e=this.playingSamples.indexOf(i);e>-1&&this.playingSamples.splice(e,1)})}stopAll(){this.playingSamples.forEach(e=>{e.bufferSourceNode.stop(0),e.bufferSourceNode.disconnect(),e.gainNode.disconnect()}),this.playingSamples=[]}}},function(e,t,n){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.PROPAGATION_STOPPED=1]="PROPAGATION_STOPPED",e[e.IMMEDIATE_PROPAGATION_STOPPED=2]="IMMEDIATE_PROPAGATION_STOPPED"}(s||(s={})),t.default=s},function(e,t,n){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.CAPTURING_PHASE=1]="CAPTURING_PHASE",e[e.AT_TARGET=2]="AT_TARGET",e[e.BUBBLING_PHASE=3]="BUBBLING_PHASE"}(s||(s={})),t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.disposed=!1}return e.prototype.isDisposed=function(){return this.disposed},e.prototype.dispose=function(){this.disposed=!0},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(6),i=n(5),r=n(4),a=function(e){function n(t,n){void 0===t&&(t=null);var s=e.call(this)||this;return s.listeners={},s.target=n||s,s.parent=t,s}return s.__extends(n,e),n.prototype.dispatchEvent=function(e){if(this.isDisposed())throw new Error("Can't dispatchEvent on a disposed EventDispatcher");var n=t.getCallTree(this,e.bubbles);e.target=this.target,e.eventPhase=1===n.length?2:1;for(var s=0;s<n.length;s+=1){var i=n[s];if(e.currentTarget=i,i===this&&(e.eventPhase=2),t.callListeners(i.listeners,e)){e.eventPhase=0;break}s===n.length-1?e.eventPhase=0:i===this&&(e.eventPhase=3)}return e.currentTarget=null,!e.defaultPrevented},n.prototype.addEventListener=function(e,t,n,s){void 0===n&&(n=!1),void 0===s&&(s=0),void 0===this.listeners[e]&&(this.listeners[e]=[]);var i=new r.default(this,e,t,n,s);return this.listeners[e].push(i),this.listeners[e].sort(this.listenerSorter),i},n.prototype.hasEventListener=function(e,t,n){if(void 0===t)return!!this.listeners[e]&&this.listeners[e].length>0;if(this.listeners[e]){for(var s=0;s<this.listeners[e].length;s+=1){var i=this.listeners[e][s];if(i.handler===t&&(void 0===n||n===i.useCapture))return!0}return!1}return!1},n.prototype.willTrigger=function(e){return this.hasEventListener(e)||!!this.parent&&this.parent.willTrigger(e)},n.prototype.removeEventListener=function(e,n,s){void 0===s&&(s=!1),t.removeListenersFrom(this.listeners,e,n,s)},n.prototype.removeAllEventListeners=function(e){t.removeListenersFrom(this.listeners,e)},n.prototype.dispose=function(){this.removeAllEventListeners(),e.prototype.dispose.call(this)},n.prototype.listenerSorter=function(e,t){return t.priority-e.priority},n}(i.default);t.default=a,t.removeListenersFrom=function(e,t,n,s){for(var i in e){if(e.hasOwnProperty(i))if((!t||i===t)&&e.hasOwnProperty(i)&&e[i]instanceof Array){for(var r=e[i],a=r.length;a;a-=1){var o=r[a-1];n&&n!==o.handler||void 0!==s&&!!s!==o.useCapture||(r.splice(a-1,1),o.isRemoved=!0)}if(t)break}}},t.getParents=function(e){for(var t=e,n=[];t.parent;)t=t.parent,n.push(t);return n},t.getCallTree=function(e,n){for(var s=[],i=t.getParents(e),r=i.length;r;r-=1)s.push(i[r-1]);return s.push(e),n&&Array.prototype.push.apply(s,i),s},t.callListeners=function(e,t){for(var n=e[t.type]?e[t.type].slice():[],s=!1,i=0;i<n.length;i+=1){var r=n[i].useCapture?3:1;if(t.eventPhase!==r&&!n[i].isRemoved){var a=t.callListener(n[i].handler);if(a>0&&(s=!0,2===a))break}}return s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(20),i=n(18);t.EventPhase=i.default;var r=n(4);t.EventListenerData=r.default;var a=n(17);t.CallListenerResult=a.default;var o=n(3);t.AbstractEvent=o.default,t.default=s.default},function(e,t){},function(e,t,n){"use strict";t.__esModule=!0,t.loadAudioBuffer=function(e,t,n){return new Promise(function(s,i){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",n&&(r.onprogress=function(e){n(e.loaded/e.total)}),r.onload=function(){if(200===r.status){var n=r.response.byteLength,a=e.decodeAudioData(r.response,function(e){s({audioBuffer:e,fileSize:n})},function(e){i(e)});a&&a.catch(function(){})}else i("Error loading '"+t+"' ("+r.status+")")},r.onerror=function(e){i(e)},r.send()})}},function(e,t,n){"use strict";t.__esModule=!0,t.ILoadAudioBufferResult=t.loadAudioBuffer=void 0;var s=n(23);t.loadAudioBuffer=s.loadAudioBuffer,t.ILoadAudioBufferResult=s.ILoadAudioBufferResult},function(e,t,n){"use strict";t.__esModule=!0,t.default=void 0;var s=n(7),i=function(){function e(e,t,n){Object.defineProperty(this,"context",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"basePath",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extension",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"samplesMap",{configurable:!0,enumerable:!0,writable:!0,value:{}}),Object.defineProperty(this,"isLoading",{configurable:!0,enumerable:!0,writable:!0,value:!1}),this.context=e,this.basePath=t,this.extension=n}var t=e.prototype;return t.loadAllSamples=function(e){return this.loadSamples(this.getAllSamples(),e)},t.loadSamples=function(e,t){var n=this;return new Promise(function(i,r){n.isLoading?r("Already loading"):(n.isLoading=!0,(0,s.loadSamples)(n.context,e,n.extension,n.basePath,t).then(function(){n.isLoading=!1,i()}))})},t.loadSamplesByName=function(e,t){var n=this,s={foundSamples:[],notFoundNames:[]};return e.forEach(function(e){n.samplesMap[e]?s.foundSamples.push(n.samplesMap[e]):s.notFoundNames.push(e)}),s.notFoundNames.length>0?Promise.reject("Loading samples failed: "+s.notFoundNames.length+" sample(s) not found in manager: "+s.notFoundNames.join(", ")):this.loadSamples(s.foundSamples,t)},t.getAllSamples=function(){var e=this;return Object.keys(this.samplesMap).map(function(t){return e.samplesMap[t]})},t.addSample=function(e){if(this.samplesMap[e.name])throw new Error("Sample with name "+e.name+" already exists");var t={name:e.name,fileName:e.fileName||e.name,path:e.path||null,extension:e.extension||null,data:e.data||null,audioBuffer:null,fileSize:-1};this.samplesMap[t.name]=t},t.addSamples=function(e){var t=this;e.forEach(function(e){return t.addSample(e)})},t.addSamplesFromNames=function(e){this.addSamples((0,s.createSamplesFromNames)(e))},t.getSampleByName=function(e){return this.samplesMap[e]||null},e}();t.default=i},function(e,t,n){"use strict";var s=n(10);t.__esModule=!0;var i={};t.default=void 0;var r=s(n(25)),a=n(7);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||(t[e]=a[e]))});var o=n(22);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||(t[e]=o[e]))});var u=r.default;t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t){this.isRunning=!1,this.callback=e,this.interval=t}start(){this.isRunning?console.error("Interval is already running"):(this.isRunning=!0,this.intervalId=window.setInterval(this.callback,1e3*this.interval))}stop(){this.isRunning=!1,clearInterval(this.intervalId)}dispose(){this.stop()}}},function(e,t,n){"use strict";function s(e,t,n){return 0===e.loopPoints.length&&1===t.lastScheduledData[n.id]}function i(e,t,n){0===e.loopPoints.length&&(t.lastScheduledData[n.id]=1)}Object.defineProperty(t,"__esModule",{value:!0}),t.getEventScheduleList=function(e,t,n){const r=[];for(let a=0;a<n.timedSequences.length;a++){const o=n.timedSequences[a],u=o.absoluteStart.toTime(n.bpm);for(let a=0;a<o.sequence.events.length;a++){const l=o.sequence.events[a];if(s(n,l,o))continue;const c=u+l.relativeStart.toTime(n.bpm);c>=e&&c<t&&(r.push({event:l,absoluteSeconds:c}),i(n,l,o))}}return r},t.clearAllLastScheduleData=function(e){for(let t=0;t<e.sequences.length;t++)for(let n=0;n<e.sequences[t].events.length;n++)e.sequences[t].events[n].lastScheduledData={}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(28),i=n(27),r=n(26),a=n(21),o=n(9),u=n(16),l=n(1),c=n(14),h=n(2),d=n(13),f=n(0);t.default=class extends a.default{constructor(e,t,n){super(),this.timeData=d.initTimeData(),this.state=l.SequencePlayerState.IDLE,this.scheduleTime={interval:1,lookAhead:1.5},this.onScheduleInterval=(()=>{this.getSongPlayTime()>this.song.getSongEndTime().toTime(this.song.bpm)&&this.stop(),this.scheduleAtTime(this.getSongPlayTime())}),this.onTimeDataUpdate=(()=>{const e=this.getSongPlayTime();this.timeData={playTime:e,playMusicTime:f.default.fromTime(e,this.song.bpm)}}),this.context=e,this.sampleManager=new r.default(this.context,t,n),this.samplePlayer=new u.default(this.context,this.context.destination),this.scheduleInterval=new i.default(this.onScheduleInterval,this.scheduleTime.interval),this.timeDataUpdater=new h.default(this.onTimeDataUpdate)}setState(e){e!==this.state&&(this.state=e,this.dispatchEvent(new c.SequencePlayerEvent("state-change",this.state)))}loadSong(e,t){return this.state!==l.SequencePlayerState.IDLE?Promise.reject("Can only load when idle"):(this.setState(l.SequencePlayerState.LOADING),this.sampleManager.loadSamplesByName(e.getUsedSampleNames(),t).then(()=>{o.setSamplesOnSampleEvents(e,this.sampleManager),this.setState(l.SequencePlayerState.IDLE)}).catch(e=>(this.setState(l.SequencePlayerState.IDLE),Promise.reject(e))))}play(e,t=!0){if(this.state!==l.SequencePlayerState.IDLE)return void console.error("Can only play when idle");let n;this.song=e,(n=e.getIsLoaded()?Promise.resolve():this.loadSong(e)).then(()=>{this.setState(l.SequencePlayerState.PLAYING),this.playStartTime=this.context.currentTime,t&&this.timeDataUpdater.start(),this.scheduleAtTime(0),this.scheduleInterval.start()})}scheduleAtTime(e){const t=e+this.scheduleTime.lookAhead;s.getEventScheduleList(e,t,this.song).forEach(e=>{this.samplePlayer.playSample(e,this.playStartTime)})}stop(){this.state===l.SequencePlayerState.PLAYING?(this.scheduleInterval.stop(),this.samplePlayer.stopAll(),this.timeDataUpdater.stop(),this.timeData=d.initTimeData(),s.clearAllLastScheduleData(this.song),this.setState(l.SequencePlayerState.IDLE)):console.error("Can only stop when playing")}getSongPlayTime(){return this.context.currentTime-this.playStartTime}getState(){return this.state}dispose(){super.dispose()}}},function(e,t,n){"use strict";t.__esModule=!0,t.default=void 0;var s=function(){function e(e,t,n,s,i){void 0===s&&(s=4),void 0===i&&(i=4),Object.defineProperty(this,"beatsPerBar",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sixteenthsPerBeat",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"beats",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bars",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sixteenths",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),this.bars=e,this.beats=t,this.sixteenths=n,this.beatsPerBar=s,this.sixteenthsPerBeat=i,this.normalize()}var t=e.prototype;return t.getCacheKey=function(e){return e+"-"+this.bars+"-"+this.beats+"-"+this.sixteenths+"-"+this.beatsPerBar+"-"+this.sixteenthsPerBeat},t.toTime=function(t){var n=this.getCacheKey(t);if(void 0===e.TO_TIME_CACHE[n]){var s=this.bars*this.beatsPerBar+this.beats+this.sixteenths/this.sixteenthsPerBeat;e.TO_TIME_CACHE[n]=60*s/t}return e.TO_TIME_CACHE[n]},t.add=function(t){return e.add(this,t)},t.subtract=function(t){return e.subtract(this,t)},t.multiply=function(t){return e.multiply(this,t)},t.equals=function(t){return e.equals(this,t)},t.normalize=function(){var e=this.sixteenths%this.sixteenthsPerBeat,t=Math.floor(this.sixteenths/this.sixteenthsPerBeat),n=(this.beats+t)%this.beatsPerBar,s=Math.floor((this.beats+t)/this.beatsPerBar),i=this.bars+s;this.sixteenths=e,this.beats=n,this.bars=i},t.clone=function(){return new e(this.bars,this.beats,this.sixteenths,this.beatsPerBar,this.sixteenthsPerBeat)},t.toSixteenths=function(){return this.sixteenths+this.sixteenthsPerBeat*this.beats+this.sixteenthsPerBeat*this.beatsPerBar*this.bars},t.toBarsFloat=function(){return this.bars+this.beats/this.beatsPerBar+this.sixteenths/this.sixteenthsPerBeat/this.beatsPerBar},t.toBeatsFloat=function(){return this.bars*this.beatsPerBar+this.beats+this.sixteenths/this.sixteenthsPerBeat},t.toString=function(){return this.bars+"."+this.beats+"."+this.sixteenths},e.subtract=function(t,n){return this.throwErrorWhenIncompatible("subtract",t,n),new e(0,0,t.toSixteenths()-n.toSixteenths())},e.fromString=function(t,n,s){void 0===n&&(n=4),void 0===s&&(s=4);var i=t.split(".");if(3!==i.length)throw new Error("Invalid string");return new e(parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10),n,s)},e.throwErrorWhenIncompatible=function(e,t,n){if(t.beatsPerBar!==n.beatsPerBar||t.sixteenthsPerBeat!==n.sixteenthsPerBeat)throw new Error("Cannot "+e+" when beatsPerBar ("+t.beatsPerBar+","+n.beatsPerBar+") or sixteenthsPerBeat ("+t.sixteenthsPerBeat+","+n.sixteenthsPerBeat+") are not equal")},e.add=function(t,n){return e.throwErrorWhenIncompatible("add",t,n),new e(t.bars+n.bars,t.beats+n.beats,t.sixteenths+n.sixteenths)},e.equals=function(e,t){return e.beatsPerBar===t.beatsPerBar&&e.sixteenthsPerBeat===t.sixteenthsPerBeat&&e.bars===t.bars&&e.beats===t.beats&&e.sixteenths===t.sixteenths},e.multiply=function(t,n){return new e(0,0,t.toSixteenths()*n)},e.fromTime=function(t,n,s){void 0===s&&(s=4);var i=t*(n*s/60);return new e(0,0,Math.floor(i))},e}();t.default=s,Object.defineProperty(s,"TO_TIME_CACHE",{configurable:!0,enumerable:!0,writable:!0,value:{}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(1),r=n(9);t.default=class{constructor(e){this.timedSequences=[],this.loopPoints=[],this.sequences=[],this.usedSampleNames=[],this.sections=[],this.songEndTime=new s.default(0,0,0),this.bpm=e}addSequenceAtTime(e,t){const n=this.sequences.find(t=>t.id===e.id);if(n&&n!==e)throw new Error(`There is already a different sequence with id ${e.id}`);n||this.sequences.push(e),this.timedSequences.push({sequence:e,absoluteStart:t,id:`${this.timedSequences.length+1}`}),e.events.forEach(e=>{e.type===i.SequenceEventType.SAMPLE&&-1===this.usedSampleNames.indexOf(e.sampleName)&&this.usedSampleNames.push(e.sampleName)}),this.songEndTime=r.getSongEndTime(this)}addSection(e,t){this.sections.push({start:e,end:t})}getSections(){return this.sections}getUsedSampleNames(){return this.usedSampleNames}getSongEndTime(){return this.songEndTime}getIsLoaded(){for(let e=0;e<this.sequences.length;e++){const t=this.sequences[e];for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n.type===i.SequenceEventType.SAMPLE&&!n.sample||!n.sample.audioBuffer)return!1}}return!0}updateSongDuration(){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(31),i=n(8),r=n(29),a=n(0),o=n(2),u=n(12),l=document.querySelector("#state"),c=document.querySelector("#time"),h=e=>{l.innerText=e},d=new AudioContext,f=new r.default(d,"samples/","wav");f.sampleManager.addSamplesFromNames(["kick","clap","synth","snare","hihat"]),h(f.getState()),f.addEventListener("state-change",e=>{h(e.data)}),new o.default(()=>{const e=f.timeData.playMusicTime;c.innerText=`${e.bars}.${e.beats}.${e.sixteenths}`}).start();const p=new s.default(128),m=i.createSampleSequence("seq1",{"0.0.0":["kick",1,"synth",1],"0.1.0":["kick",1,"clap",1],"0.2.0":["kick",1],"0.3.0":["kick",1,"clap",1],"1.0.0":["kick",1],"1.1.0":["kick",1,"clap",1],"1.2.0":["kick",1],"1.3.0":["kick",1,"clap",1],"2.0.0":["kick",1],"2.1.0":["clap",1],"2.2.0":[],"2.3.0":["clap",1],"3.0.0":["kick",1],"3.1.0":["clap",1],"3.2.0":[],"3.3.0":["clap",1]}),y=i.createSampleSequence("snare",{"0.2.2":["snare"],"1.3.0":["snare"],"2.2.2":["snare"],"3.0.0":["snare",1/8],"3.0.2":["snare",.25],"3.1.0":["snare",3/8],"3.1.2":["snare",.5],"3.2.0":["snare",5/8],"3.2.2":["snare",.75],"3.3.0":["snare",7/8],"3.3.2":["snare",1]}),v=i.createSampleSequence("hihat",{"0.0.0":["hihat"],"0.0.1":["hihat"],"0.0.2":["hihat"],"0.0.3":["hihat"]});p.addSequenceAtTime(m,new a.default(0,0,0)),p.addSequenceAtTime(m,new a.default(4,0,0)),p.addSequenceAtTime(m,new a.default(8,0,0)),p.addSequenceAtTime(y,new a.default(0,0,0)),p.addSequenceAtTime(y,new a.default(4,0,0)),p.addSequenceAtTime(v,new a.default(4,0,0)),p.addSequenceAtTime(v,new a.default(5,0,0)),p.addSequenceAtTime(v,new a.default(6,0,0)),p.addSequenceAtTime(v,new a.default(7,0,0)),document.querySelector("#start").addEventListener("click",()=>{f.play(p)}),document.querySelector("#stop").addEventListener("click",()=>{f.stop(),console.log(a.default.TO_TIME_CACHE)});const b=new u.default(document.querySelector("#editor"),f);p.addSection(a.default.fromString("4.0.0"),a.default.fromString("8.0.0")),b.setSong(p)}]);